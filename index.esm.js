var e,t=function(e){return"boolean"==typeof e},n=function(e){return null!==e&&"object"==typeof e},i=function(e){return function(e){return"object"==typeof e&&Array.isArray(e)}(e)&&(1===e.length||2===e.length)},r=function(e){return"number"==typeof e},f={uint8Max:255,int8Min:-128,int8Max:127,uint16Max:65535,int16Min:-32768,int16Max:32767,uint32Max:4294967295,int32Min:-2147483648,int32Max:2147483647};!function(e){e.int8="int8",e.uint8="uint8",e.int16="int16",e.uint16="uint16",e.int32="int32",e.uint32="uint32",e.float32="float32",e.float64="float64",e.boolean="boolean",e.string8="string8",e.string16="string16",e.string="string"}(e||(e={}));var o=function(e){return"string"==typeof e.type};function s(f,l,u){var v,p;if(i(l)){var c={type:null!==(p=null===(v=l[1])||void 0===v?void 0:v.lengthType)&&void 0!==p?p:e.uint32};if(u.byteOffset+=a(u,c,f.length),o(l[0]))for(var b=0,g=f;b<g.length;b++){var w=g[b];u.byteOffset+=a(u,l[0],w)}else for(var O=0,d=f;O<d.length;O++){s(w=d[O],l[0],u)}}else for(var h in l){var x=f[h],T=l[h];if(r(x)||t(x))u.byteOffset+=a(u,T,x);else if(n(x))o(T)&&T.compress?u.byteOffset+=a(u,T,x):s(x,T,u);else{if("string"!=typeof x){var U="";throw void 0===x&&(U="Template property ".concat(h,", is not found from data ").concat(f,".")),"function"==typeof u.onErrorCallback&&u.onErrorCallback(U),Error(U)}var B=m(x),k={type:y(T.type)};u.byteOffset+=a(u,k,B.byteLength),u.byteOffset+=a(u,T,B)}}}var l=function(f,s,a){var v,p,c;if(void 0===a&&(a=0),i(s)&&Array.isArray(f)){if(w=!0,a+=u({type:null!==(p=null===(v=s[1])||void 0===v?void 0:v.lengthType)&&void 0!==p?p:e.uint32},f.length),f.length>0)if(o(s[0]))a+=u(s[0])*f.length;else if(null===(c=s[1])||void 0===c?void 0:c.pure){var b=a,g=(a=l(f[0],s[0],a))-b;a+=(f.length-1)*g}else for(var O=0;O<f.length;O++)a=l(f[O],s[0],a)}else for(var d in s){var h=f[d],x=s[d];if(r(h)||t(h))a+=u(x);else if(n(h))o(x)&&x.compress?a+=u(x):a=l(h,x,a);else if("string"==typeof h){w=!0;var T=m(h);a+=u({type:y(x.type)},T.byteLength),a+=T.byteLength}}return a},y=function(t){return t===e.string8?e.uint8:t===e.string16?e.uint16:e.uint32};function a(t,n,i){var f=0;return n.compress?i=n.compress.pack(i):r(n.multiplier)&&r(i)&&(i*=n.multiplier),n.type===e.uint8?(n.preventOverflow&&(i=i<0?0:i>255?255:i),t.view.setUint8(t.byteOffset,i),f=1):n.type===e.int8?(n.preventOverflow&&(i=i<-128?-128:i>127?127:i),t.view.setInt8(t.byteOffset,i),f=1):n.type===e.boolean?(t.view.setInt8(t.byteOffset,!1===i?0:1),f=1):n.type===e.uint16?(n.preventOverflow&&(i=i<0?0:i>65535?65535:i),t.view.setUint16(t.byteOffset,i),f=2):n.type===e.int16?(n.preventOverflow&&(i=i<-32768?-32768:i>32767?32767:i),t.view.setInt16(t.byteOffset,i),f=2):n.type===e.uint32?(n.preventOverflow&&(i=i<0?0:i>4294967295?4294967295:i),t.view.setUint32(t.byteOffset,i),f=4):n.type===e.int32?(n.preventOverflow&&(i=i<-2147483648?-2147483648:i>2147483647?2147483647:i),t.view.setInt32(t.byteOffset,i),f=4):n.type===e.float32?(t.view.setFloat32(t.byteOffset,i),f=4):n.type===e.float64?(t.view.setFloat64(t.byteOffset,i),f=8):(n.type!==e.string8&&n.type!==e.string16&&n.type!==e.string||i instanceof Uint8Array&&i.forEach((function(e,n){t.view.setUint8(n+t.byteOffset,e)})),f=i.byteLength),f}function u(t,n){var i=0;return t.type===e.int8||t.type===e.uint8||t.type===e.boolean?i=1:t.type===e.int16||t.type===e.uint16?i=2:t.type===e.int32||t.type===e.uint32||t.type===e.float32?i=4:t.type===e.string8||t.type===e.string16||t.type===e.string?i=n instanceof Uint8Array?n.byteLength:t.type===e.string8?1:t.type===e.string16?2:4:t.type===e.float64&&(i=8),i}function v(t,n,f){var s,l,y,a,u;if(o(n))u=p(t,n,f);else if(i(n)){u=[];for(var c=p(t,{type:null!==(l=null===(s=n[1])||void 0===s?void 0:s.lengthType)&&void 0!==l?l:e.uint32},f),b=null!==(a=null===(y=n[1])||void 0===y?void 0:y.unpackCallback)&&void 0!==a?a:null,g=0;g<(r(c)?c:0);g++){var w=v(t,n[0],f);"function"==typeof b?null!=(w=b(w))&&u.push(w):u.push(w)}}else for(var O in u={},n){var d=n[O];o(d)?u[O]=p(t,d,f):u[O]=v(t,d,f)}return u}function p(t,n,i){var f,o=0;if(n.type===e.uint8)f=i.view.getUint8(i.byteOffset),o=1;else if(n.type===e.int8)f=i.view.getInt8(i.byteOffset),o=1;else if(n.type===e.boolean)f=0!==i.view.getInt8(i.byteOffset),o=1;else if(n.type===e.uint16)f=i.view.getUint16(i.byteOffset),o=2;else if(n.type===e.int16)f=i.view.getInt16(i.byteOffset),o=2;else if(n.type===e.uint32)f=i.view.getUint32(i.byteOffset),o=4;else if(n.type===e.int32)f=i.view.getInt32(i.byteOffset),o=4;else if(n.type===e.float32)f=i.view.getFloat32(i.byteOffset),o=4;else if(n.type===e.float64)f=i.view.getFloat64(i.byteOffset),o=8;else if(n.type===e.string8||n.type===e.string16||n.type===e.string){o=u(n);var s=void 0,l=void 0;n.type===e.string8?(o+=s=i.view.getUint8(i.byteOffset),l=i.byteOffset+1):n.type===e.string16?(o+=s=i.view.getUint16(i.byteOffset),l=i.byteOffset+2):(o+=s=i.view.getUint32(i.byteOffset),l=i.byteOffset+4);var y=l+s;f=c(t.slice(l,y))}return n.compress?f=n.compress.unpack(f):r(n.multiplier)&&r(f)&&(f/=n.multiplier),i.byteOffset+=o,f}var c,b,g=new Map,w=!1,O=function(e,t,n){var i,r,f,o;if(void 0===n&&(n={}),void 0!==n.sharedBuffer)o=n.sharedBuffer;else if(n.cacheBufferByTemplate){var y=g.get(t);if(!y){w=!1;var a=null!==(i=n.bufferSizeInBytes)&&void 0!==i?i:l(e,t);if(w)throw Error("Dynamic data (array or string) can not be serialized with cacheBufferByTemplate option enabled.");y=new ArrayBuffer(a),g.set(t,y)}o=y}else{a=null!==(r=n.bufferSizeInBytes)&&void 0!==r?r:l(e,t);o=new ArrayBuffer(a)}return s(e,t,{byteOffset:null!==(f=n.byteOffset)&&void 0!==f?f:0,view:new DataView(o),onErrorCallback:n.onErrorCallback}),o},d=function(e,t,n){void 0===n&&(n={});var i=n.byteOffset;return v(e,t,{byteOffset:void 0===i?0:i,view:new DataView(e)})},h=function(e){return function(t){return e.decode(t)}};"function"==typeof TextDecoder&&(b=new TextDecoder,c=h(b));var m,x,T=function(e){return function(t){return e.encode(t)}};"function"==typeof TextEncoder&&(x=new TextEncoder,m=T(x));var U=function(e){m=T(e),c=h(e)},B={pack:O,unpack:d,utils:{setTextHandler:U,calculateBufferSize:l,Types:e}};export{f as Limits,e as Types,l as calculateBufferSize,B as default,O as pack,U as setTextHandler,d as unpack};
