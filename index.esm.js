var t,e=function(t){return"boolean"==typeof t},n=function(t){return null!==t&&"object"==typeof t},i=function(t){return function(t){return"object"==typeof t&&Array.isArray(t)}(t)&&(1===t.length||2===t.length)},f=function(t){return"number"==typeof t},r={uint8Max:255,int8Min:-128,int8Max:127,uint16Max:65535,int16Min:-32768,int16Max:32767,uint32Max:4294967295,int32Min:-2147483648,int32Max:2147483647};!function(t){t.int8="int8",t.uint8="uint8",t.int16="int16",t.uint16="uint16",t.int32="int32",t.uint32="uint32",t.float32="float32",t.float64="float64",t.boolean="boolean",t.string8="string8",t.string16="string16",t.string="string"}(t||(t={}));var o=function(t){return"string"==typeof t.type};function y(r,s,u){var v,p;if(i(s)){var c={type:null!==(p=null===(v=s[1])||void 0===v?void 0:v.lengthType)&&void 0!==p?p:t.uint32};if(u.byteOffset+=l(u,c,r.length),o(s[0]))for(var b=0,g=r;b<g.length;b++){var w=g[b];u.byteOffset+=l(u,s[0],w)}else for(var O=0,d=r;O<d.length;O++){y(w=d[O],s[0],u)}}else for(var h in s){var x=r[h],m=s[h];if(n(x))o(m)&&m.compress?u.byteOffset+=l(u,m,x):y(x,m,u);else if(f(x)||e(x))u.byteOffset+=l(u,m,x);else{if("string"!=typeof x){var I="";throw void 0===x&&(I="Template property ".concat(h,", is not found from data ").concat(r,".")),"function"==typeof u.onErrorCallback&&u.onErrorCallback(I),Error(I)}var T=M(x),U={type:a(m.type)};u.byteOffset+=l(u,U,T.byteLength),u.byteOffset+=l(u,m,T)}}}var s=function(r,y,l){var v,p,c;if(void 0===l&&(l=0),i(y)&&Array.isArray(r)){if(w=!0,l+=u({type:null!==(p=null===(v=y[1])||void 0===v?void 0:v.lengthType)&&void 0!==p?p:t.uint32},r.length),r.length>0)if(o(y[0]))l+=u(y[0])*r.length;else if(null===(c=y[1])||void 0===c?void 0:c.pure){var b=l,g=(l=s(r[0],y[0],l))-b;l+=(r.length-1)*g}else for(var O=0;O<r.length;O++)l=s(r[O],y[0],l)}else for(var d in y){var h=r[d],x=y[d];if(n(h))o(x)&&x.compress?l+=u(x):l=s(h,x,l);else if(f(h)||e(h))l+=u(x);else if("string"==typeof h){w=!0;var m=M(h);l+=u({type:a(x.type)},m.byteLength),l+=m.byteLength}}return l},a=function(e){return e===t.string8?t.uint8:e===t.string16?t.uint16:t.uint32};function l(e,n,i){var r=0;return n.compress?i=n.compress.pack(i):f(n.multiplier)&&f(i)&&(i*=n.multiplier),n.type===t.uint8?((n.preventOverflow||n.infinity)&&(i=i<0?0:i>255?255:i),e.view.setUint8(e.byteOffset,i),r=1):n.type===t.int8?((n.preventOverflow||n.infinity)&&(i=i<-128?-128:i>127?127:i),e.view.setInt8(e.byteOffset,i),r=1):n.type===t.boolean?(e.view.setInt8(e.byteOffset,!1===i?0:1),r=1):n.type===t.uint16?((n.preventOverflow||n.infinity)&&(i=i<0?0:i>65535?65535:i),e.view.setUint16(e.byteOffset,i),r=2):n.type===t.int16?((n.preventOverflow||n.infinity)&&(i=i<-32768?-32768:i>32767?32767:i),e.view.setInt16(e.byteOffset,i),r=2):n.type===t.uint32?((n.preventOverflow||n.infinity)&&(i=i<0?0:i>4294967295?4294967295:i),e.view.setUint32(e.byteOffset,i),r=4):n.type===t.int32?((n.preventOverflow||n.infinity)&&(i=i<-2147483648?-2147483648:i>2147483647?2147483647:i),e.view.setInt32(e.byteOffset,i),r=4):n.type===t.float32?(e.view.setFloat32(e.byteOffset,i),r=4):n.type===t.float64?(e.view.setFloat64(e.byteOffset,i),r=8):(n.type!==t.string8&&n.type!==t.string16&&n.type!==t.string||i instanceof Uint8Array&&i.forEach((function(t,n){e.view.setUint8(n+e.byteOffset,t)})),r=i.byteLength),r}function u(e,n){var i=0;return e.type===t.int8||e.type===t.uint8||e.type===t.boolean?i=1:e.type===t.int16||e.type===t.uint16?i=2:e.type===t.int32||e.type===t.uint32||e.type===t.float32?i=4:e.type===t.string8||e.type===t.string16||e.type===t.string?i=n instanceof Uint8Array?n.byteLength:e.type===t.string8?1:e.type===t.string16?2:4:e.type===t.float64&&(i=8),i}function v(e,n,r){var y,s,a,l,u;if(i(n)){u=[];for(var c=p(e,{type:null!==(s=null===(y=n[1])||void 0===y?void 0:y.lengthType)&&void 0!==s?s:t.uint32},r),b=null!==(l=null===(a=n[1])||void 0===a?void 0:a.unpackCallback)&&void 0!==l?l:null,g=0;g<(f(c)?c:0);g++){var w=v(e,n[0],r);b?null!=(w=b(w))&&u.push(w):u.push(w)}}else if(o(n))u=p(e,n,r);else for(var O in u={},n){var d=n[O];o(d)?u[O]=p(e,d,r):u[O]=v(e,d,r)}return u}function p(e,n,i){var o,y=0;if(n.type===t.uint8)o=i.view.getUint8(i.byteOffset),n.infinity&&o===r.uint8Max&&(o=Infinity),y=1;else if(n.type===t.int8)o=i.view.getInt8(i.byteOffset),!n.infinity||o>r.int8Min&&o<r.int8Max||(o*=Infinity),y=1;else if(n.type===t.boolean)o=0!==i.view.getInt8(i.byteOffset),y=1;else if(n.type===t.uint16)o=i.view.getUint16(i.byteOffset),n.infinity&&o===r.uint16Max&&(o=Infinity),y=2;else if(n.type===t.int16)o=i.view.getInt16(i.byteOffset),!n.infinity||o>r.int16Min&&o<r.int16Max||(o*=Infinity),y=2;else if(n.type===t.uint32)o=i.view.getUint32(i.byteOffset),n.infinity&&o===r.uint32Max&&(o=Infinity),y=4;else if(n.type===t.int32)o=i.view.getInt32(i.byteOffset),!n.infinity||o>r.int32Min&&o<r.int32Max||(o*=Infinity),y=4;else if(n.type===t.float32)o=i.view.getFloat32(i.byteOffset),y=4;else if(n.type===t.float64)o=i.view.getFloat64(i.byteOffset),y=8;else if(n.type===t.string8||n.type===t.string16||n.type===t.string){y=u(n);var s=void 0,a=void 0;n.type===t.string8?(y+=s=i.view.getUint8(i.byteOffset),a=i.byteOffset+1):n.type===t.string16?(y+=s=i.view.getUint16(i.byteOffset),a=i.byteOffset+2):(y+=s=i.view.getUint32(i.byteOffset),a=i.byteOffset+4);var l=a+s;o=c(e.slice(a,l))}return n.compress?o=n.compress.unpack(o):f(n.multiplier)&&f(o)&&(o/=n.multiplier),i.byteOffset+=y,o}var c,b,g=new Map,w=!1,O=function(t,e,n){var i,f,r,o;if(void 0===n&&(n={}),void 0!==n.sharedBuffer)o=n.sharedBuffer;else if(n.cacheBufferByTemplate){var a=g.get(e);if(!a){w=!1;var l=null!==(i=n.bufferSizeInBytes)&&void 0!==i?i:s(t,e);if(w)throw Error("Dynamic data (array or string) can not be serialized with cacheBufferByTemplate option enabled.");a=new ArrayBuffer(l),g.set(e,a)}o=a}else{l=null!==(f=n.bufferSizeInBytes)&&void 0!==f?f:s(t,e);o=new ArrayBuffer(l)}return y(t,e,{byteOffset:null!==(r=n.byteOffset)&&void 0!==r?r:0,view:new DataView(o),onErrorCallback:n.onErrorCallback}),o},d=function(t,e,n){void 0===n&&(n={});var i=n.byteOffset;return v(t,e,{byteOffset:void 0===i?0:i,view:new DataView(t)})},h=function(t){return function(e){return t.decode(e)}};"function"==typeof TextDecoder&&(b=new TextDecoder,c=h(b));var M,x,m=function(t){return function(e){return t.encode(e)}};"function"==typeof TextEncoder&&(x=new TextEncoder,M=m(x));var I=function(t){M=m(t),c=h(t)},T={pack:O,unpack:d,utils:{setTextHandler:I,calculateBufferSize:s,Types:t}};export{r as Limits,t as Types,s as calculateBufferSize,T as default,O as pack,I as setTextHandler,d as unpack};
